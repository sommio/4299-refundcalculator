# 退款计算器

一个基于 React + TypeScript + Vite 的退款计算器，用于计算订阅服务的剩余价值。

## 项目概述

退款计算器根据不同的产品类型（月循环/年循环）和相应的费用构成，精确计算订阅服务在宕机时的剩余价值。该工具特别适用于云计算服务、网络流量服务等需要按比例退款的场景。

## 功能特性

### 🔄 支持两种产品类型
- **月循环流量产品**：固定费用模式，流量包含在月费中
- **年循环流量产品**：固定费用 + 流量费用的组合模式

### 📊 精确计算逻辑
- 日固定费用摊销
- 剩余天数计算
- 流量费用分摊（仅年循环产品）
- 剩余流量价值评估（仅年循环产品）

### 🎨 现代化界面
- 响应式设计，支持移动端
- 优雅的渐变色彩主题
- 实时表单验证
- 详细的计算过程展示

### ⚡ 高性能
- TypeScript 类型安全
- React 19 最新特性
- Vite 快速构建

## 技术栈

- **前端框架**：React 19.1.1
- **类型系统**：TypeScript 5.9
- **构建工具**：Vite 7.1.7
- **代码规范**：ESLint + React Hooks
- **样式方案**：CSS3 + Flexbox + Grid

## 项目结构

```
src/
├── components/           # React 组件
│   ├── RefundCalculator.tsx    # 主计算器组件
│   ├── MonthlyProductForm.tsx  # 月循环产品表单
│   ├── YearlyProductForm.tsx   # 年循环产品表单
│   └── ResultDisplay.tsx       # 结果显示组件
├── types/               # TypeScript 类型定义
│   └── index.ts         # 核心类型接口
├── utils/               # 工具函数
│   └── calculator.ts    # 计算逻辑
├── App.tsx              # 根组件
└── main.tsx             # 应用入口
```

## 计算规则

### 月循环流量产品

**费用构成：**
- 固定费用 = 订阅总价（流量已包含在内）

**计算公式：**
```
日固定费用 = 订阅价格 ÷ (订阅周期 × 30.4167)
剩余天数 = 订阅结束日期 - 退款日期
剩余价值 = 剩余天数 × 日固定费用
```

**示例：**
- 订阅价格：￥300/月
- 剩余天数：20 天
- 日固定费用 = 300 ÷ 30.4167 ≈ ￥9.86
- 剩余价值 = 20 × 9.86 = ￥197.20

### 年循环流量产品

**费用构成：**
- 固定费用：计算资源、IP 地址等不随流量使用的资源费用
- 流量费用：订阅总价 - 固定费用

**计算公式：**
```
日固定费用 = 固定费用 ÷ 365
流量单价 = 流量费用 ÷ 总流量
剩余流量 = 总流量 - 已用流量
剩余天数 = 订阅结束日期 - 退款日期
剩余价值 = (剩余天数 × 日固定费用) + (剩余流量 × 流量单价)
```

**示例：**
- 订阅总价：￥3,000
- 固定费用：￥2,000
- 总流量：10TB (10,000GB)
- 已用流量：4TB (4,000GB)
- 剩余天数：95 天

计算过程：
```
流量费用 = 3,000 - 2,000 = ￥1,000
流量单价 = 1,000 ÷ 10,000 = ￥0.10/GB
剩余流量 = 10,000 - 4,000 = 6,000GB
日固定费用 = 2,000 ÷ 365 ≈ ￥5.48
剩余价值 = (95 × 5.48) + (6,000 × 0.10) = ￥520.60 + ￥600 = ￥1,120.60
```

## 使用方法

### 1. 安装依赖
```bash
pnpm install
```

### 2. 启动开发服务器
```bash
pnpm dev
```

### 3. 构建生产版本
```bash
pnpm build
```

### 4. 预览生产版本
```bash
pnpm preview
```

### 5. 代码检查
```bash
pnpm lint
```

## 使用界面

1. **选择产品类型**：在顶部选择"月循环流量产品"或"年循环流量产品"

2. **填写基本信息**：
   - 月循环产品：订阅价格、订阅周期、退款日期、订阅结束日期
   - 年循环产品：订阅总价、固定费用、总流量、已用流量、退款日期、订阅结束日期

3. **点击计算**：系统会自动验证输入并计算剩余价值

4. **查看结果**：显示详细的计算结果和计算过程说明

## 数据验证

系统包含完善的表单验证机制：

### 通用验证
- 退款日期必须早于订阅结束日期
- 所有金额字段必须大于等于0

### 月循环产品验证
- 订阅价格 > 0
- 订阅周期 > 0

### 年循环产品验证
- 订阅总价 > 0
- 固定费用 >= 0 且 < 订阅总价
- 总流量 > 0
- 已用流量 >= 0 且 <= 总流量

## 浏览器支持

- Chrome/Edge 88+
- Firefox 85+
- Safari 14+

## 开发说明

### 核心组件

1. **RefundCalculator**：主控制器，管理状态和用户交互
2. **MonthlyProductForm**：月循环产品输入表单
3. **YearlyProductForm**：年循环产品输入表单
4. **ResultDisplay**：计算结果展示组件

### 核心工具函数

- `calculateRemainingValue()`：主计算函数
- `calculateDaysDifference()`：日期差计算
- `roundToTwoDecimal()`：金额格式化
- `formatCurrency()`：货币显示格式化
- `formatTraffic()`：流量显示格式化

### 类型设计

项目采用严格的 TypeScript 类型系统，确保类型安全：
- `ProductInput`：产品输入数据联合类型
- `CalculationResult`：计算结果接口
- `MonthlyProductInput`：月循环产品输入接口
- `YearlyProductInput`：年循环产品输入接口